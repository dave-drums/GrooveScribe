<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Embedded Groove</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="./js/groove_display.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script>
      GrooveDisplay.AddGrooveDisplayToPage(location.search, true, true);
    </script>

    <script>
      (function () {
        // Extra space at the bottom for the expanded GrooveScribe toolbar
        var TOOLBAR_PADDING = 120; // tweak if still tight

        function getDocHeight() {
          var d = document;
          return Math.max(
            d.body.scrollHeight,
            d.documentElement.scrollHeight,
            d.body.offsetHeight,
            d.documentElement.offsetHeight,
            d.body.clientHeight,
            d.documentElement.clientHeight
          );
        }

        function sendGrooveHeight() {
          var height = getDocHeight() + TOOLBAR_PADDING;

          height = Math.ceil(height);

          window.parent.postMessage(
            {
              type: "grooveHeight",
              height: height
            },
            "*"
          );
        }

        // Initial send (slight delay to let GrooveScribe render)
        window.addEventListener("load", function () {
          setTimeout(sendGrooveHeight, 200);
        });

        // Re-send on window resize (orientation change etc.)
        window.addEventListener("resize", function () {
          setTimeout(sendGrooveHeight, 100);
        });

        // Periodically check for internal layout changes
        // (e.g. play bar expanded / collapsed)
        var lastHeight = 0;
        setInterval(function () {
          var current = getDocHeight();
          if (Math.abs(current - lastHeight) > 10) {
            lastHeight = current;
            sendGrooveHeight();
          }
        }, 500);
      })();
    </script>
  </body>
</html>
