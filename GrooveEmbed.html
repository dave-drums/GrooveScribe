<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Embedded Groove</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="./js/groove_display.js"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <!-- Render the embedded groove -->
    <script>
      GrooveDisplay.AddGrooveDisplayToPage(location.search, true, true);
    </script>

    <!-- Auto-height messaging with MutationObserver (no polling, no resize loop) -->
    <script>
      function sendGrooveHeight() {
        var h =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight ||
          0;

        // Small buffer so the bottom of the player never clips
        h = Math.ceil(h) + 32;

        window.parent.postMessage(
          {
            type: "grooveHeight",
            height: h
          },
          "*"
        );
      }

      window.addEventListener("load", function () {
        // Initial size once everything has rendered
        sendGrooveHeight();

        // Observe any DOM changes (e.g. player expand/collapse)
        var target = document.body;
        var pending = false;

        var observer = new MutationObserver(function (mutations) {
          // Debounce multiple rapid mutations into one height update
          if (pending) return;
          pending = true;
          setTimeout(function () {
            pending = false;
            sendGrooveHeight();
          }, 150);
        });

        observer.observe(target, {
          childList: true,
          subtree: true,
          attributes: true
        });
      });

      // Note: no resize or interval handlers here on purpose.
      // Height only updates when the DOM actually changes (e.g. player UI toggled),
      // so thereâ€™s no feedback loop or slow creeping growth.
    </script>
  </body>
</html>
